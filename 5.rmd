```{r}
library(ggplot2)

# 1. Carrega i neteja les dades

data <- read.csv("base_dades_districtes.csv", stringsAsFactors = FALSE)

# Elimina files amb valors nuls
data_clean <- data[!is.na(data$availability_365) & !is.na(data$review_scores_rating), ]

# 2. Gràfic de dispersió 

ggplot(data_clean, aes(x = availability_365, y = review_scores_rating)) +
  geom_point(color = "orange", alpha = 0.5, size = 2) +
  geom_smooth(method = "lm", se = TRUE, color = "red", size = 1.2) +
  labs(
    title = "Correlation between availability and guest rating",
    x = "Anual availability",
    y = "Average guest rating"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5)
  )
```
This R code uses the ggplot2 library to show the relationship between the number of days a listing is available per year and its average guest rating. First, it loads the data from a CSV file called base_dades_districtes.csv and removes any rows that have missing values in the columns availability_365 (annual availability) or review_scores_rating (guest rating). Then, it creates a scatter plot where each orange dot represents a listing. The dots are slightly transparent so it's easier to see where there are many points. A red line is added to show the overall trend between availability and rating.

With this graphic, we can observe several interesting things. The first is that the majority of the reviews are very positive, which makes it harder to determine whether there is a real correlation. One possible explanation is that if the guest is satisfied, they are more likely to leave a good review, which could explain the high ratings.
In terms of availability, we can see that it is fairly well distributed, with only a small dip in the middle range (150–250 days). The red line shows a visual representation of the correlation between the two variables. In this case, we see a downward trend. This means that higher availability of the Airbnb tends to be associated with lower reviews.
There are several conclusions we can draw from this. One possible reason is that the more guests an Airbnb receives, the greater the need for cleaning. If the host does not follow a strict cleaning routine, this can negatively affect the guest’s experience. Poor reviews might not only result from cleanliness issues; furniture can also break more easily with frequent use. Damaged or worn-out furniture may also lead to negative reviews. Finally, a high number of guests may result in a more impersonal and distant relationship between the host and the guest, which could potentially cause some discomfort for the guest and may also be a reason for a lower review.

```{r}

library(ggplot2)

# 1. Carregar i netejar les dades

data <- read.csv("base_dades_districtes.csv", stringsAsFactors = FALSE)

# Elimina files amb NA a les columnes rellevants
data <- data[!is.na(data$availability_365) &
               !is.na(data$review_scores_rating) &
               !is.na(data$neighbourhood), ]

# Normalitza noms de districtes
data$neighbourhood <- tolower(trimws(data$neighbourhood))
data$neighbourhood[data$neighbourhood %in% c("nou barris", "noubarris", "nou_barris")] <- "nou barris"

# Posa amb majúscules
capitalize_words <- function(x) {
  sapply(strsplit(x, " "), function(y) {
    paste(toupper(substring(y, 1,1)), substring(y, 2), sep="", collapse=" ")
  })
}
data$neighbourhood <- capitalize_words(data$neighbourhood)

# Elimina el districte "Desconegut"
data <- data[data$neighbourhood != "Desconegut", ]

# 2. Crear trams de disponibilitat

data$availability_group <- cut(
  data$availability_365,
  breaks = c(0, 90, 180, 270, 365),
  labels = c("0-90 days", "91-180 days", "181-270 days", "271-365 days"),
  include.lowest = TRUE
)

# 3. Crear el gràfic

ggplot(data, aes(x = neighbourhood, y = review_scores_rating, fill = availability_group)) +
  geom_boxplot(outlier.shape = 18, outlier.size = 2, alpha = 0.8) +
  labs(
    title = "Availability and guest rating by neighbourhood",
    x = "Neighbourhood",
    y = "Average review rating",
    fill = "Availability"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "right",
    plot.title = element_text(hjust = 0.5)  # Aquí centres el títol
```
