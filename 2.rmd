```{r}
data <- read.csv("base_dades_districtes.csv")
```

```{r}
# 1. Load libraries (install if needed)
if (!require("ggplot2")) install.packages("ggplot2")
if (!require("dplyr")) install.packages("dplyr")
library(ggplot2)
library(dplyr)

# 3. Data cleaning and preparation
data <- data %>%
  mutate(
    amenities_count = as.numeric(amenities_count),
    amenities_premium_count = as.numeric(amenities_premium_count),
    price = as.numeric(price)
  ) %>%
  filter(
    !is.na(amenities_count),
    !is.na(amenities_premium_count),
    !is.na(price)
  )

# 4. Filter outliers (adjust thresholds as needed)
data_filtered <- data %>%
  filter(
    amenities_count <= 50,
    amenities_premium_count <= 15,
    price <= quantile(price, 0.95, na.rm = TRUE)
  )

# 5. Create combined scatter plot
ggplot(data_filtered, aes(x = amenities_count, y = price, color = amenities_premium_count)) +
  geom_point(alpha = 0.6, size = 2) +
  geom_smooth(method = "lm", se = FALSE, color = "black", linetype = "dashed") +
  scale_color_gradient(low = "skyblue", high = "red", 
                       name = "Premium Amenities Count") +
  labs(
    title = "Relationship Between Price, Total Amenities and Premium Amenities",
    x = "Total Number of Amenities",
    y = "Price (â‚¬)",
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5, size = 14),
    plot.subtitle = element_text(hjust = 0.5, color = "gray40"),
    legend.position = "bottom",
    legend.title = element_text(face = "bold")
  )

# 6. Optional: Save the plot
ggsave("price_amenities_relationship.png", width = 10, height = 6, dpi = 300)

```