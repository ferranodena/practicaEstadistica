## Carregar el dataset

```{r}
data <- read.csv(".\\base_dades_districtes_amb_professionalism.csv")
```	

## Correlació entre les variables

```{r}
# 1. Veiem les classes de cada columna
str(data)

# 2. Filtrem només les columnes numèriques
data_numeric <- data[, sapply(data, is.numeric)]

# 3. Calculem la matriu de correlació només amb les columnes numèriques
cor_matrix <- cor(data_numeric, use = "complete.obs")

# 4. Mostrem la matriu de correlació
print(cor_matrix)
```

## Gràfic de dispersió
```{r}
plot(data$variable1, data$variable2)
```

## Gràfic de dispersió amb línia de regressió
```{r}
plot(data$accommodates, data$square_meters)
abline(lm(data$square_meters ~ data$accommodates))
```

## Preu per metre quadrat per districte
```{r}
# Comprovar els noms de les columnes
colnames(data)

# Filtrar les files on square_feet no és NA ni 0
data_filtered <- data[!is.na(data$square_meters) & data$square_meters > 0, ]

# Verificar si tenim dades suficients després del filtratge
if(nrow(data_filtered) > 0) {
  # Calcular el preu per metre quadrat
  data_filtered$price_per_sqft <- data_filtered$price / data_filtered$square_meters
  
  # Calcular la mitjana del preu per metre quadrat per districte
  district_price_per_sqft <- aggregate(price_per_sqft ~ neighbourhood, data = data_filtered, FUN = mean)
  
  # Ordenar els districtes per preu per metre quadrat (en ordre descendent)
  district_price_per_sqft <- district_price_per_sqft[order(district_price_per_sqft$price_per_sqft, decreasing = TRUE), ]
  
  # Crear el barplot
  barplot(district_price_per_sqft$price_per_sqft, 
          names.arg = district_price_per_sqft$neighbourhood,
          col = "lightgreen",
          main = "Preu mitjà per metre quadrat per districte",
          xlab = "Districte",
          ylab = "Preu per metre quadrat (€/m²)",
          las = 2,  # Etiquetes horitzontals
          cex.names = 0.8)  # Mida de les etiquetes
  
  # Afegir etiquetes de valor
  text(x = seq_along(district_price_per_sqft$price_per_sqft) - 0.5, 
       y = district_price_per_sqft$price_per_sqft + max(district_price_per_sqft$price_per_sqft)*0.03,
       labels = round(district_price_per_sqft$price_per_sqft, 2),  # Mostrar 2 decimals
       cex = 0.7,
       pos = 3)
  
  # Imprimir taula amb resultats
  print(district_price_per_sqft)
} else {
  print("No hi ha prou dades amb valors vàlids de 'square_feet' per calcular el preu per metre quadrat.")
}
```

### Piechart amb el percentatge de propietats per tipus de propietat
```{r}
# Calcular el percentatge de propietats per tipus de propietat
property_type_percent <- prop.table(table(data$property_type)) * 100

# Crear el piechart
pie(property_type_percent,
    main = "Percentatge de propietats per tipus de propietat",
    col = rainbow(length(property_type_percent)),  # Colors de l'arc de l'arc de cada sector
    cex = 0.8,  # Mida de les etiquetes
    labels = paste(names(property_type_percent), " (", round(property_type_percent, 2), "%)", sep = ""))  # Etiquetes amb percentatge
```

## Piechart per veure els percentatge de host_response_time
```{r}
# Calcular el percentatge de propietats per tipus de propietat si hi ha dadew
property_type_percent <- prop.table(table(data$host_response_time)) * 100

# Crear el piechart
pie(property_type_percent,
    main = "Percentatge de propietats per tipus de propietat",
    col = rainbow(length(property_type_percent)),  # Colors de l'arc de l'arc de cada sector
    cex = 0.8,  # Mida de les etiquetes
    labels = paste(names(property_type_percent), " (", round(property_type_percent, 2), "%)", sep = ""))  # Etiquetes amb percentatge

```

## Histograma de host_listings_count
```{r}
# Comprovar si hi ha dades vàlides per host_listings_count
if (any(!is.na(data$host_listings_count) & data$host_listings_count > 0)) {
  # Filtrar les files on host_listings_count no és NA ni 0
  data_filtered <- data[!is.na(data$host_listings_count) & data$host_listings_count > 0 & data$host_listings_count <= 50, ]
  
  # Crear l'histograma
  hist(data_filtered$host_listings_count,
       main = "Histograma de host_listings_count (1-50)",
       xlab = "Host Listings Count",
       ylab = "Frecuencia",
       col = "lightblue",
       breaks = seq(min(data_filtered$host_listings_count), max(data_filtered$host_listings_count), by = 1))  # Nombre de bins
} else {
  print("No hi ha dades vàlides per host_listings_count.")
}
```
## Piechart de host_has_profile_pic
```{r}
# Comprovar si hi ha dades vàlides per host_has_profile_pic
if (any(!is.na(data$host_has_profile_pic))) {
  # Calcular el percentatge de propietats per host_has_profile_pic
  host_profile_pic_percent <- prop.table(table(data$host_has_profile_pic)) * 100
  
  # Crear el piechart
  pie(host_profile_pic_percent,
      main = "Percentatge de propietats amb imatge de perfil d'amfitrió",
      col = rainbow(length(host_profile_pic_percent)),  # Colors de l'arc de l'arc de cada sector
      cex = 0.8,  # Mida de les etiquetes
      labels = paste(names(host_profile_pic_percent), " (", round(host_profile_pic_percent, 2), "%)", sep = ""))  # Etiquetes amb percentatge
} else {
  print("No hi ha dades vàlides per host_has_profile_pic.")
}
```
## Histograma de availability_365
```{r}
# Comprovar si hi ha dades vàlides per availability_365
if (any(!is.na(data$availability_365) & data$availability_365 > 0)) {
  # Filtrar les files on availability_365 no és NA ni 0
  data_filtered <- data[!is.na(data$availability_365) & data$availability_365 > 0, ]
  
  # Crear l'histograma
  hist(data_filtered$availability_365,
       main = "Histograma de availability_365",
       xlab = "Availability (dies a l'any)",
       ylab = "Frecuencia",
       col = "lightblue",
       breaks = seq(min(data_filtered$availability_365), max(data_filtered$availability_365), by = 1))  # Nombre de bins
} else {
  print("No hi ha dades vàlides per availability_365.")
}
```
## Histograma de review_scores_rating (estan de l'1 al 100)
```{r}
# Comprovar si hi ha dades vàlides per review_scores_rating
if (any(!is.na(data$review_scores_rating) & data$review_scores_rating > 0)) {
  # Filtrar les files on review_scores_rating no és NA ni 0
  data_filtered <- data[!is.na(data$review_scores_rating) & data$review_scores_rating > 0, ]
  
  # Crear l'histograma
  hist(data_filtered$review_scores_rating,
       main = "Histograma de review_scores_rating",
       xlab = "Review Scores Rating",
       ylab = "Frecuencia",
       col = "lightblue",
       breaks = seq(min(data_filtered$review_scores_rating), max(data_filtered$review_scores_rating), by = 1))  # Nombre de bins
} else {
  print("No hi ha dades vàlides per review_scores_rating.")
}
```
## Gràfic de dispersió entre availability_365 i review_scores_rating i linia de regressió
```{r}
# Comprovar si tenim el paquet 'hexbin'
if (!requireNamespace("hexbin", quietly = TRUE)) {
  install.packages("hexbin")
}
library(hexbin)

# Comprovar si hi ha dades vàlides
if (any(!is.na(data$availability_365) & !is.na(data$review_scores_rating))) {
  # Filtrar les files on availability_365 i review_scores_rating no són NA
  data_filtered <- data[!is.na(data$availability_365) & !is.na(data$review_scores_rating), ]
  
  # Crear un gràfic hexagonal
  bin <- hexbin(data_filtered$availability_365, data_filtered$review_scores_rating, 
                xbins = 30)
  
  # Representar el gràfic
  plot(bin, main = "Densitat de la correlació disponibilitat - puntuació",
       xlab = "Disponibilitat (dies a l'any)",
       ylab = "Puntuació de les ressenyes",
       colramp = colorRampPalette(c("lightblue", "darkblue")))
  
  # Afegir la línia de regressió
  fit <- lm(review_scores_rating ~ availability_365, data = data_filtered)
  abline(fit, col = "red", lwd = 2)
  
  # Mostrar coeficient de correlació i p-valor
  correlation <- cor.test(data_filtered$availability_365, data_filtered$review_scores_rating)
  text(max(data_filtered$availability_365) * 0.7, min(data_filtered$review_scores_rating) + 5, 
       paste("Correlació:", round(correlation$estimate, 3), 
             "\np-valor:", format.pval(correlation$p.value, digits = 3)),
       pos = 4, col = "darkred")
} else {
  print("No hi ha dades vàlides per availability_365 o review_scores_rating.")
}
```
## Gràfic de dispersió entre number:of_reviews i review_scores_rating i linia de regressió
```{r}

plot(data$number_of_reviews, data$review_scores_rating)
abline(lm(data$review_scores_rating ~ data$number_of_reviews))
```
## Càlcul mitjanes tal
```{r}
# Càlcul del preu mitjà per nit
preu_mitjà <- mean(data$price, na.rm = TRUE)
cat("Preu mitjà per nit:", round(preu_mitjà, 2), "€\n\n")
mediana_preu <- median(data$price, na.rm = TRUE)
cat("Mediana del preu per nit:", round(mediana_preu, 2), "€\n\n")

# Diferències de preus entre barris
preus_per_barri <- aggregate(price ~ neighbourhood, data = data, FUN = mean)
preus_per_barri <- preus_per_barri[order(preus_per_barri$price, decreasing = TRUE), ]
cat("Preus mitjans per barri:\n")
print(preus_per_barri)
cat("\n")

# Barri amb més llistats
llistats_per_barri <- table(data$neighbourhood)
llistats_per_barri <- sort(llistats_per_barri, decreasing = TRUE)
cat("Nombre de llistats per barri:\n")
print(llistats_per_barri)
cat("\n")

# Tipus de propietat més comú
tipus_propietat <- table(data$property_type)
tipus_propietat <- sort(tipus_propietat, decreasing = TRUE)
cat("Nombre de llistats per tipus de propietat:\n")
print(head(tipus_propietat, 10))  # Mostrem només els 10 primers
cat("\n")

# Tipus d'habitació més freqüent
tipus_habitacio <- table(data$room_type)
tipus_habitacio <- sort(tipus_habitacio, decreasing = TRUE)
cat("Nombre de llistats per tipus d'habitació:\n")
print(tipus_habitacio)
cat("\n")

# Nombre mitjà de ressenyes per llistat
mitjana_ressenyes <- mean(data$number_of_reviews, na.rm = TRUE)
mediana_ressenyes <- median(data$number_of_reviews, na.rm = TRUE)
max_ressenyes <- max(data$number_of_reviews, na.rm = TRUE)
cat("Nombre mitjà de ressenyes per llistat:", round(mitjana_ressenyes, 2), "\n")
cat("Mediana de ressenyes per llistat:", mediana_ressenyes, "\n")
cat("Màxim de ressenyes per llistat:", max_ressenyes, "\n\n")

# Nombre mínim mitjà de nits
mitjana_min_nits <- mean(data$minimum_nights, na.rm = TRUE)
mediana_min_nits <- median(data$minimum_nights, na.rm = TRUE)
cat("Nombre mínim mitjà de nits:", round(mitjana_min_nits, 2), "\n")
cat("Mediana del nombre mínim de nits:", mediana_min_nits, "\n\n")

# Disponibilitat
disponibilitat_stats <- table(cut(data$availability_365, 
                           breaks = c(-1, 100, 200, 300, 366), 
                           labels = c("0-100 dies", "101-200 dies", "201-300 dies", "301-365 dies")))
cat("Disponibilitat anual:\n")
print(disponibilitat_stats)
cat("Percentatge de disponibilitat per categories:\n")
print(round(prop.table(disponibilitat_stats) * 100, 2))
cat("\n")

# Puntuació mitjana
mitjana_puntuacio <- mean(data$review_scores_rating, na.rm = TRUE)
mediana_puntuacio <- median(data$review_scores_rating, na.rm = TRUE)
cat("Puntuació mitjana de les ressenyes:", round(mitjana_puntuacio, 2), "/100\n")
cat("Mediana de les puntuacions:", mediana_puntuacio, "/100\n\n")

listings_with_reviews <- sum(data$number_of_reviews > 0, na.rm = TRUE)
percentage_with_reviews <- (listings_with_reviews / nrow(data)) * 100
cat("Percentatge de llistings amb review:", round(percentage_with_reviews, 2), "%\n")

# Resum general (taula estadística)
cat("Resum estadístic general:\n")
print(summary(data[, c("price", "minimum_nights", "availability_365", 
                       "number_of_reviews", "review_scores_rating", 
                       "accommodates", "amenities_count")]))

```
## Visualització gràfica de les dades

```{r}
# Gràfic de barres per a preus per barri
barplot(preus_per_barri$price, 
        names.arg = preus_per_barri$neighbourhood,
        main = "Preu mitjà per barri",
        xlab = "Barri",
        ylab = "Preu mitjà (€)",
        las = 2,
        cex.names = 0.7,
        col = "skyblue")
```

# Gràfic de barres per a llistats per barri
```{r}
barplot(llistats_per_barri[1:10], 
        main = "Els 10 barris amb més llistats",
        xlab = "Barri",
        ylab = "Nombre de llistats",
        las = 2,
        cex.names = 0.7,
        col = "lightgreen")
```

# Gràfic de pastís per a tipus d'habitació
```{r}
pie(tipus_habitacio, 
    main = "Distribució per tipus d'habitació",
    col = rainbow(length(tipus_habitacio)),
    labels = paste(names(tipus_habitacio), " (", 
                  round(prop.table(tipus_habitacio) * 100, 1), "%)", sep = ""))
```

# Histograma del mínim de nits
```{r}
hist(data$minimum_nights[data$minimum_nights <= 20], 
     main = "Distribució del mínim de nits (<=20)", 
     xlab = "Mínim de nits", 
     col = "salmon", 
     breaks = 20)
```

## Fes piechart del percentatge que tenen review i els que no
```{r}
# Comprovar si hi ha dades vàlides per review_scores_rating
if (any(!is.na(data$review_scores_rating))) {
  # Calcular el percentatge de propietats amb i sense puntuació
  review_percent <- prop.table(table(!is.na(data$review_scores_rating))) * 100
  
  # Crear el piechart
  pie(review_percent,
      main = "Percentatge de propietats amb i sense puntuació",
      col = rainbow(length(review_percent)),  # Colors de l'arc de l'arc de cada sector
      cex = 0.8,  # Mida de les etiquetes
      labels = paste(names(review_percent), " (", round(review_percent, 2), "%)", sep = ""))  # Etiquetes amb percentatge
} else {
  print("No hi ha dades vàlides per review_scores_rating.")
}
```

## Mapa de correlacions entre totes les variables numèriques

```{r}
# Carregar les llibreries necessàries
if (!requireNamespace("corrplot", quietly = TRUE)) {
  install.packages("corrplot")
}
library(corrplot)

# Filtrem només les columnes numèriques (excloent les que hem creat pel càlcul del professionalism)
cols_to_exclude <- c("availability_score", "listings_score", "response_time_score")
data_numeric_filtered <- data_numeric[, !names(data_numeric) %in% cols_to_exclude]

# Calculem la matriu de correlació
cor_matrix <- cor(data_numeric_filtered, use = "pairwise.complete.obs")

# Visualitzem el mapa de correlacions amb rectangles colorejats en lloc de cercles
corrplot(cor_matrix, 
         method = "color",   # Utilitzem colors sòlids en lloc de cercles
         type = "upper",     # Mostrar només la part superior de la matriu
         order = "hclust",   # Ordenar variables per similitud de correlacions
         tl.col = "black",   # Color del text de les etiquetes
         tl.srt = 45,        # Rotació del text (45 graus)
         addCoef.col = "black", # Color dels coeficients
         number.cex = 0.7,   # Mida dels coeficients
         tl.cex = 0.7,       # Mida de les etiquetes
         col = colorRampPalette(c("#6D9EC1", "white", "#E46726"))(200),
         title = "Mapa de correlacions entre les variables numèriques",
         mar = c(0, 0, 1, 0)) # Marges del gràfic

# Crear una visualització més detallada amb números
par(mfrow = c(1, 1))  # Restablir la configuració del gràfic
```
